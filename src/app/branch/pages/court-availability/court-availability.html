<div style="display: flex; justify-content: center;">
    <div class="availability-container">
        <mat-card style="display: flex; justify-content: space-between" [style.background-color]="injected ? '#f5f5f5' : '#ffffff'">
            <mat-card-header>
                <mat-card-title>Gestionar Ocupación</mat-card-title>
                <mat-card-subtitle>Bloquea horarios para clases o mantenimiento</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
                <div style="display: flex; flex-direction: column; gap: 16px; margin-top: 10px;">
                    <mat-form-field appearance="outline" subscriptSizing="dynamic">
                        <mat-label>Motivo del bloqueo</mat-label>
                        <mat-select>
                            <mat-option value="class">Clase de Entrenamiento</mat-option>
                            <mat-option value="maintenance">Mantenimiento</mat-option>
                            <mat-option value="event">Evento Especial</mat-option>
                        </mat-select>
                        <!--
                        <mat-select [(ngModel)]="blockReason">
                            <mat-option value="class">Clase de Entrenamiento</mat-option>
                            <mat-option value="maintenance">Mantenimiento</mat-option>
                            <mat-option value="event">Evento Especial</mat-option>
                        </mat-select>
                        -->
                    </mat-form-field>
                    <mat-form-field appearance="outline" subscriptSizing="dynamic">
                        <mat-label>Rango de fechas</mat-label>
                        <mat-date-range-input [rangePicker]="picker">
                            <input matStartDate placeholder="Inicio">
                            <input matEndDate placeholder="Fin">
                        </mat-date-range-input>
                        <!--
                        <mat-date-range-input [rangePicker]="picker">
                            <input matStartDate placeholder="Inicio" [(ngModel)]="startDate">
                            <input matEndDate placeholder="Fin" [(ngModel)]="endDate">
                        </mat-date-range-input>
                        -->
                        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-date-range-picker #picker></mat-date-range-picker>
                    </mat-form-field>
                    <mat-form-field appearance="outline" subscriptSizing="dynamic">
                        <mat-label>Hora Inicio</mat-label>
                        <input matInput type="time">
                    </mat-form-field>
                    <mat-form-field appearance="outline" subscriptSizing="dynamic">
                        <mat-label>Hora Fin</mat-label>
                        <input matInput type="time">
                    </mat-form-field>
                    <!--
                    <mat-form-field appearance="outline" subscriptSizing="dynamic">
                        <mat-label>Hora Inicio</mat-label>
                        <input matInput type="time" [(ngModel)]="startTime">
                    </mat-form-field>
                    <mat-form-field appearance="outline" subscriptSizing="dynamic">
                        <mat-label>Hora Fin</mat-label>
                        <input matInput type="time" [(ngModel)]="endTime">
                    </mat-form-field>
                    -->
                    <div>
                        <mat-checkbox>¿Se repite cada semana?</mat-checkbox>
                        <mat-chip-listbox multiple>
                            <mat-chip-option>L</mat-chip-option>
                            <mat-chip-option>M</mat-chip-option>
                            <mat-chip-option>X</mat-chip-option>
                            <mat-chip-option>J</mat-chip-option>
                            <mat-chip-option>V</mat-chip-option>
                            <mat-chip-option>S</mat-chip-option>
                            <mat-chip-option>D</mat-chip-option>
                        </mat-chip-listbox>
                        <!--
                        <mat-checkbox [(ngModel)]="isRecurring">¿Se repite cada semana?</mat-checkbox>
                        @if (isRecurring) {
                            <mat-chip-listbox multiple class="days-selector">
                                <mat-chip-option>L</mat-chip-option>
                                <mat-chip-option>M</mat-chip-option>
                                <mat-chip-option>X</mat-chip-option>
                                <mat-chip-option>J</mat-chip-option>
                                <mat-chip-option>V</mat-chip-option>
                                <mat-chip-option>S</mat-chip-option>
                                <mat-chip-option>D</mat-chip-option>
                            </mat-chip-listbox>
                        }
                        -->
                    </div>
                </div>
            </mat-card-content>
            <mat-card-actions align="end" style="display: flex; gap: 8px;">
                <button matButton="outlined">Limpiar</button>
                <button matButton="filled">Guardar Bloqueo</button>
            </mat-card-actions>
        </mat-card>
        <mat-card class="list-card" [style.background-color]="injected ? '#f5f5f5' : '#ffffff'">
            <mat-card-header>
                <mat-card-title>Horarios Ocupados</mat-card-title>
            </mat-card-header>
            <mat-list>
                @if (dataLoaded === 1) {
                    <div style="margin: 8px; overflow: auto;">
                        <table mat-table [dataSource]="blockedTimes">
                            <ng-container matColumnDef="icon">
                                <th mat-header-cell *matHeaderCellDef style="font-weight: 600; background: #f5f5f5"></th>
                                <td mat-cell *matCellDef="let t">
                                    <div style="display: flex; justify-content: center;">
                                        <mat-icon>{{ t.type === 'maintenance' ? 'build' : 'school' }}</mat-icon>
                                    </div>
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="title">
                                <th mat-header-cell *matHeaderCellDef style="font-weight: 600; background: #f5f5f5"> Nombre </th>
                                <td mat-cell *matCellDef="let t">
                                    {{ t.title }}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="actions">
                                <th mat-header-cell *matHeaderCellDef style="font-weight: 600; background: #f5f5f5; text-align: right"> Acciones </th>
                                <td mat-cell *matCellDef="let t">
                                    <div style="display: flex; justify-content: end;">
                                        <button mat-icon-button (click)="deleteBlock(t.id)">
                                            <mat-icon>delete</mat-icon>
                                        </button>
                                    </div>
                                </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                        </table>
                    </div>
                } @else if (dataLoaded === 0) {
                    <div style="display: flex; justify-content: center; margin: 20px 0">
                        <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
                    </div>
                } @else {
                    <div style="display: flex; flex-direction: column; align-items: center; margin: 20px 0">
                        <mat-icon>search_off</mat-icon>
                        <span>No hay bloqueos configurados.</span>
                    </div>
                }
            </mat-list>
        </mat-card>
    </div>
</div>
