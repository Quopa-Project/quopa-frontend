<div style="width: min(500px, 90vw); background-color: white;">
    <h2 mat-dialog-title>Gestionar peticiones</h2>
    <mat-dialog-content style="display: flex; flex-direction: column; gap: 16px;">
        <mat-card style="padding: 16px">
            <div style="display: flex; flex-direction: column; gap: 6px;">
                <div style="display:flex; align-items:center; gap:8px;">
                    <mat-icon aria-hidden="true">event</mat-icon>
                    <span style="font-weight: 700; font-size: 18px;">
                      Booking #{{ data.booking.id }}
                    </span>
                </div>
                <div style="display:flex; align-items:center; gap:8px;">
                    <mat-icon aria-hidden="true">schedule</mat-icon>
                    <span>
                      {{ data.booking.date | date:'fullDate' }} · {{ data.booking.time }}
                    </span>
                </div>
                <div style="display:flex; align-items:center; gap:8px;">
                    <mat-icon aria-hidden="true">sports_tennis</mat-icon>
                    <span>
                      {{ data.booking.court.sport.name }} - {{ data.booking.court.description }}
                    </span>
                </div>
                <div style="display:flex; align-items:center; gap:8px;">
                    <mat-icon aria-hidden="true">place</mat-icon>
                    <span>
                      {{ data.booking.court.branch.name }} · {{ data.booking.court.branch.address }}
                    </span>
                </div>
                <div style="display:flex; align-items:center; gap:8px;">
                    <mat-icon aria-hidden="true">group</mat-icon>
                    <span>
                      Personas: <strong>{{ data.booking.numberOfPeople }}</strong>
                    </span>
                </div>
                <div style="display:flex; align-items:center; gap:8px;">
                    <mat-icon aria-hidden="true">payments</mat-icon>
                    <span>
                      Total: <strong>{{ data.booking.totalPrice }}</strong>
                    </span>
                </div>
                <div style="display:flex; align-items:center; gap:8px;">
                    <mat-icon aria-hidden="true">info</mat-icon>
                    <span>
                      Estado: <strong>{{ data.booking.status }}</strong>
                    </span>
                </div>
            </div>
        </mat-card>
        @if (dataLoaded === 1) {
            <div style="margin: 8px; overflow: auto;">
                <table mat-table [dataSource]="joinBookings">
                    <ng-container matColumnDef="user">
                        <th mat-header-cell *matHeaderCellDef style="font-weight: 600; background: #f5f5f5"> Usuario </th>
                        <td mat-cell *matCellDef="let j">
                            {{ j.user.name }} - {{ j.user.lastName }}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="isPayed">
                        <th mat-header-cell *matHeaderCellDef style="font-weight: 600; background: #f5f5f5"> Pagado </th>
                        <td mat-cell *matCellDef="let j">
                            {{ j.isPayed ? 'Si' : 'No' }}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="status">
                        <th mat-header-cell *matHeaderCellDef style="font-weight: 600; background: #f5f5f5"> Estado </th>
                        <td mat-cell *matCellDef="let j">
                            {{ j.status }}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef style="font-weight: 600; background: #f5f5f5; text-align: right"> Acciones </th>
                        <td mat-cell *matCellDef="let j">
                            <div style="display: flex; justify-content: end;">
                                @if (j.status === 'Solicitado') {
                                    <button mat-icon-button (click)="confirmJoinRequest(j)">
                                        <mat-icon>check_circle</mat-icon>
                                    </button>
                                    <button mat-icon-button (click)="cancelJoinRequest(j)">
                                        <mat-icon>cancel</mat-icon>
                                    </button>
                                }
                            </div>
                        </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                </table>
            </div>
        } @else if (dataLoaded === 0) {
            <div style="display: flex; justify-content: center">
                <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
            </div>
        } @else {
            <div style="display: flex; flex-direction: column; align-items: center">
                <mat-icon>search_off</mat-icon>
                <span>No se encontraron peticiones.</span>
            </div>
        }
    </mat-dialog-content>
    <mat-dialog-actions>
        <button mat-button mat-dialog-close [disabled]="savingJoinBooking">Cerrar</button>
        @if (savingJoinBooking) {
            <div style="margin-left: 8px">
                <mat-progress-spinner diameter="24" mode="indeterminate"></mat-progress-spinner>
            </div>
        }
    </mat-dialog-actions>
</div>

